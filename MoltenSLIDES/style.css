/* =========================================
   MOLTENLAVA DESIGN SYSTEM V4 - FINAL
   ========================================= */

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

:root {
    /* Colors */
    --bg-body: #09090b;       /* Deepest Black */
    --bg-surface: #121214;    /* Panel Background */
    --bg-elevated: #27272a;   /* Inputs / Hover */
    --border-subtle: #27272a;
    
    --text-main: #ffffff;
    --text-muted: #a1a1aa;

    --accent-orange: #ff5e3a; 
    --accent-dim: rgba(255, 94, 58, 0.15);
    --selection-blue: #3b82f6; /* Standard Text Selection Blue */
    --selection-dim: rgba(59, 130, 246, 0.1);

    --font-main: 'Inter', system-ui, sans-serif;
    --sidebar-width: 240px;
    --toolbar-height: 64px; /* Taller, airy toolbar */
}

/* === RESET === */
* { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
html, body { width: 100%; height: 100%; overflow: hidden; background: var(--bg-body); color: var(--text-main); font-family: var(--font-main); }

/* === HUB LAYOUT (Restored) === */
.app-container { 
    max-width: 1400px; margin: 0 auto; padding: 3rem 5%; height: 100vh; overflow-y: auto; 
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .app-container { padding: 1rem 3%; }
    .editor-toolbar { 
        height: auto; 
        flex-wrap: wrap; 
        padding: 0.75rem; 
        gap: 8px;
    }
    .toolbar-group { gap: 6px; flex-wrap: wrap; }
    .slide-strip { width: 180px; min-width: 180px; }
    :root { --sidebar-width: 180px; }
}

@media (max-width: 480px) {
    .slide-strip { display: none; } /* Hide sidebar on very small screens */
    .bottom-bar { 
        bottom: 10px; 
        left: 10px; 
        right: 10px;
        transform: none;
        border-radius: 12px;
        flex-wrap: wrap;
        max-width: calc(100vw - 20px);
    }
}

/* Touch support */
@media (hover: none) and (pointer: coarse) {
    .tool-btn, .format-btn { width: 44px; height: 44px; }
    .slide-control-btn { width: 36px; height: 36px; }
}

.grid-gallery { 
    display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; 
}

@media (max-width: 768px) {
    .grid-gallery { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
}
.card {
    background: var(--bg-surface); border: 1px solid var(--border-subtle);
    border-radius: 12px; overflow: hidden; position: relative; cursor: pointer;
    transition: transform 0.2s, border-color 0.2s;
}
.card:hover { transform: translateY(-4px); border-color: #3f3f46; }
.card-new {
    border: 2px dashed var(--border-subtle); display: flex; flex-direction: column;
    align-items: center; justify-content: center; min-height: 260px;
}
.card-new:hover { border-color: var(--accent-orange); background: var(--accent-dim); }
.file-card { min-height: 260px; display: flex; flex-direction: column; }
.card-thumb { height: 160px; background: white; border-bottom: 1px solid var(--border-subtle); position: relative; overflow: hidden; }
.card-body { padding: 1.25rem; }
.card-title { font-weight: 600; margin-bottom: 0.25rem; }
.card-meta { font-size: 0.85rem; color: var(--text-muted); }
.card-menu-btn {
    position: absolute; top: 12px; right: 12px; width: 32px; height: 32px; border-radius: 6px;
    background: rgba(0,0,0,0.6); border: none; color: white; display: grid; place-items: center;
    opacity: 0; transition: 0.2s; cursor: pointer; z-index: 10;
}
.card:hover .card-menu-btn { opacity: 1; }

/* === EDITOR LAYOUT === */
.editor-shell { display: flex; flex-direction: column; width: 100%; height: 100%; }

/* MODERN TOOLBAR */
.editor-toolbar {
    height: var(--toolbar-height); background: var(--bg-surface); 
    border-bottom: 1px solid var(--border-subtle);
    display: flex; align-items: center; justify-content: space-between; 
    padding: 0 1.5rem; flex-shrink: 0; z-index: 1000;
    position: relative;
}
.toolbar-group { display: flex; align-items: center; gap: 8px; }
.toolbar-divider { width: 1px; height: 24px; background: var(--border-subtle); margin: 0 8px; }

/* Modern Buttons (Borderless until active) */
.tool-btn {
    width: 40px; height: 40px; border-radius: 8px;
    color: var(--text-muted); cursor: pointer; transition: 0.2s;
    display: grid; place-items: center; background: transparent; border: none;
}
.tool-btn:hover { background: var(--bg-elevated); color: var(--text-main); }
.tool-btn.active { 
    background: var(--accent-dim); color: var(--accent-orange); 
}
.tool-btn svg { width: 20px; height: 20px; } /* Slightly larger icons */

.btn-primary {
    background: var(--accent-orange); color: white; padding: 0.6rem 1.2rem;
    border-radius: 8px; font-weight: 600; font-size: 0.9rem; border: none; cursor: pointer;
    display: flex; align-items: center; gap: 8px; transition: 0.2s;
}
.btn-primary:hover { background: #ff7e60; transform: translateY(-1px); }

/* WORKSPACE */
.editor-workspace { display: flex; flex: 1; overflow: hidden; position: relative; background: #050505; }

/* SIDEBAR */
.slide-strip {
    width: var(--sidebar-width); min-width: var(--sidebar-width);
    background: var(--bg-body); border-right: 1px solid var(--border-subtle);
    display: flex; flex-direction: column; padding: 1rem; gap: 1rem; overflow-y: auto; z-index: 40;
}
.slide-thumbnail {
    aspect-ratio: 16/9; background: white; border-radius: 6px; 
    overflow: hidden; cursor: pointer; border: 2px solid transparent; position: relative;
    transition: 0.2s;
}
.slide-thumbnail.active { border-color: var(--accent-orange); box-shadow: 0 0 0 2px var(--accent-dim); }
.slide-num { font-size: 0.75rem; color: var(--text-muted); width: 20px; text-align: right; }
.thumb-scaler { width: 1280px; height: 720px; position: absolute; top: 0; left: 0; transform-origin: top left; pointer-events: none; background: white; }

/* CANVAS */
.canvas-area { flex: 1; display: flex; align-items: center; justify-content: center; overflow: hidden; }
.slide-content {
    background: white; width: 1280px; height: 720px; position: relative;
    box-shadow: 0 0 100px rgba(0,0,0,0.5);
}
.editor-scaler { transform-origin: center center; will-change: transform; }

/* === ELEMENTS === */
.slide-element {
    position: absolute; cursor: grab; display: flex; box-sizing: border-box;
    user-select: none; -webkit-user-select: none;
    will-change: transform, width, height; /* Optimization */
}

/* Selected State */
.slide-element.selected { 
    outline: 2px solid var(--accent-orange); z-index: 100; 
}

/* Editing State (Modern Look) */
.slide-element.editing { 
    outline: 2px solid var(--selection-blue); /* Standard Blue Selection */
    cursor: text; 
    user-select: text !important; -webkit-user-select: text !important;
    z-index: 200; 
}

.element-text {
    width: 100%; height: 100%; margin: 0; padding: 0;
    white-space: pre-wrap; word-break: break-word; outline: none;
    background: transparent; cursor: inherit;
    /* Selection Color inside text */
    ::selection { background: var(--selection-dim); color: inherit; }
}

.element-image { width: 100%; height: 100%; display: block; pointer-events: none; object-fit: fill; }
.element-shape { width: 100%; height: 100%; display: block; pointer-events: none; }

/* HANDLES */
.resize-handle {
    width: 10px; height: 10px; background: white; border: 1px solid var(--accent-orange);
    position: absolute; z-index: 300; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.handle-nw { top: -5px; left: -5px; cursor: nw-resize; }
.handle-ne { top: -5px; right: -5px; cursor: ne-resize; }
.handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; }
.handle-se { bottom: -5px; right: -5px; cursor: se-resize; }

.rotate-handle {
    width: 24px; height: 24px; background: var(--bg-surface); border: 1px solid var(--accent-orange);
    color: var(--accent-orange); position: absolute; top: -35px; left: 50%; transform: translateX(-50%);
    border-radius: 50%; cursor: grab; z-index: 300; display: grid; place-items: center;
}
.rotate-line { width: 1px; height: 25px; background: var(--accent-orange); position: absolute; top: -25px; left: 50%; pointer-events: none; }

/* === FLOATING PROPERTIES BAR (Modernized) === */
.bottom-bar {
    position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
    background: rgba(24, 24, 27, 0.9); backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.1); border-radius: 100px;
    padding: 6px 16px; display: flex; align-items: center; gap: 8px; /* Tighter gap */
    box-shadow: 0 20px 40px rgba(0,0,0,0.4); z-index: 500;
    transition: 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
}
.bottom-bar.hidden { opacity: 0; pointer-events: none; transform: translate(-50%, 20px) scale(0.95); }

.font-select {
    background: transparent; border: none; color: white;
    font-size: 0.9rem; width: 140px; cursor: pointer; outline: none;
    font-weight: 500;
}
.font-select option { background: var(--bg-surface); color: white; padding: 8px; }

.font-size-input {
    background: transparent; border: 1px solid rgba(255,255,255,0.2);
    color: white; width: 60px; padding: 6px; border-radius: 6px;
    text-align: center; font-size: 0.85rem; font-weight: 500;
    -moz-appearance: textfield; /* Remove arrows in Firefox */
    appearance: textfield;
}
.font-size-input::-webkit-outer-spin-button,
.font-size-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
.font-size-input:focus { border-color: var(--accent-orange); }

/* Canvas panning */
.canvas-area {
    position: relative;
    cursor: default;
}
.canvas-area.panning {
    cursor: grab;
}
.canvas-area.panning.active {
    cursor: grabbing;
}

.slide-canvas {
    transition: transform 0.1s ease-out;
    will-change: transform;
}

.format-btn {
    width: 32px; height: 32px; border-radius: 8px; background: transparent; border: none;
    color: var(--text-muted); cursor: pointer; display: grid; place-items: center; transition: 0.1s;
}
.format-btn:hover { background: rgba(255,255,255,0.1); color: white; }
.format-btn.active { background: var(--accent-dim); color: var(--accent-orange); }

.color-wrapper { width: 28px; height: 28px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); overflow: hidden; position: relative; cursor: pointer; }
.color-input { width: 150%; height: 150%; position: absolute; top: -25%; left: -25%; border: none; cursor: pointer; }

/* PRESENTATION MODE */
body.presenting .editor-toolbar, body.presenting .slide-strip, body.presenting .bottom-bar { display: none !important; }
body.presenting .editor-shell { background: black; }
body.presenting .canvas-area { background: black; padding: 0; }
body.presenting .slide-content { box-shadow: none; border: none; }

/* Presentation Transitions */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideFromRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes slideFromLeft {
    from { transform: translateX(-100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes zoomIn {
    from { transform: scale(0.5); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.transition-fade { animation: fadeIn 0.5s ease-out; }
.transition-slide-right { animation: slideFromRight 0.5s ease-out; }
.transition-slide-left { animation: slideFromLeft 0.5s ease-out; }
.transition-zoom { animation: zoomIn 0.5s ease-out; }

/* Element Animations */
@keyframes appear {
    from { opacity: 0; transform: scale(0.8); }
    to { opacity: 1; transform: scale(1); }
}

@keyframes flyInLeft {
    from { opacity: 0; transform: translateX(-100%); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes flyInRight {
    from { opacity: 0; transform: translateX(100%); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes flyInTop {
    from { opacity: 0; transform: translateY(-100%); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes flyInBottom {
    from { opacity: 0; transform: translateY(100%); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-30px); }
    60% { transform: translateY(-15px); }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

/* Animation classes */
.anim-appear { animation: appear 0.6s ease-out; }
.anim-fly-left { animation: flyInLeft 0.6s ease-out; }
.anim-fly-right { animation: flyInRight 0.6s ease-out; }
.anim-fly-top { animation: flyInTop 0.6s ease-out; }
.anim-fly-bottom { animation: flyInBottom 0.6s ease-out; }
.anim-bounce { animation: bounce 1s ease-out; }
.anim-pulse { animation: pulse 1s ease-out; }

/* MODALS */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8); backdrop-filter: blur(4px);
    z-index: 2000; display: flex; justify-content: center; align-items: center;
}
.modal {
    background: var(--bg-surface); border: 1px solid var(--border-subtle);
    border-radius: 12px; padding: 2rem; width: 400px; text-align: center;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}
.hidden { display: none !important; }

/* === HUB UI FIXES === */

/* 1. Search Bar Fix */
.search-input {
    width: 100%;
    background: var(--bg-input);
    border: 1px solid var(--border-light);
    color: var(--text-main);
    padding: 0.8rem 1rem 0.8rem 2.8rem; /* Padding for icon */
    border-radius: 8px;
    font-family: var(--font-main);
    font-size: 0.95rem;
    transition: 0.2s;
}
.search-input:focus {
    border-color: var(--accent-orange);
    box-shadow: 0 0 0 2px rgba(255, 94, 58, 0.15);
}

/* 2. Dropdown Menu (3-Dots) Fix */
.menu-dropdown {
    position: absolute;
    top: 45px;
    right: 10px;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    border-radius: 8px;
    padding: 4px;
    min-width: 140px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    z-index: 50;
    display: flex;
    flex-direction: column;
}

.menu-item {
    padding: 8px 12px;
    font-size: 0.85rem;
    color: var(--text-muted);
    cursor: pointer;
    border-radius: 4px;
    transition: 0.1s;
}
.menu-item:hover { background: rgba(255,255,255,0.05); color: white; }
.menu-item.danger:hover { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

/* 3. Modal (Delete/Rename Popup) Fix */
.modal-header { font-size: 1.2rem; font-weight: 700; margin-bottom: 1rem; color: var(--text-main); }
.modal-body { color: var(--text-muted); margin-bottom: 1.5rem; line-height: 1.5; }
.modal-actions { display: flex; justify-content: flex-end; gap: 12px; }

/* Modal Buttons */
.btn { padding: 0.6rem 1.2rem; border-radius: 6px; font-weight: 600; cursor: pointer; border: none; font-size: 0.9rem; }
.btn-primary { background: var(--accent-orange); color: white; }
.btn-primary:hover { background: #ff7e60; }
.btn-secondary { background: var(--bg-elevated); color: white; border: 1px solid var(--border-subtle); }
.btn-secondary:hover { background: #3f3f46; }
.btn-danger { background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }
.btn-danger:hover { background: rgba(239, 68, 68, 0.3); color: white; }

.dropdown-container {
    position: relative;
}

.dropdown-menu {
    position: absolute; top: 100%; left: 0;
    background: var(--bg-surface); border: 1px solid var(--border-subtle);
    border-radius: 8px; padding: 4px; min-width: 160px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    display: none; flex-direction: column; z-index: 2000;
}

/* Prevent dropdown cutoff */
.dropdown-menu.align-right { left: auto; right: 0; }
.dropdown-menu.align-top { top: auto; bottom: 100%; margin-bottom: 4px; }

.dropdown-container.active .dropdown-menu { display: flex; }

.dropdown-item {
    padding: 8px 12px; font-size: 0.85rem; color: var(--text-muted);
    cursor: pointer; border-radius: 4px; display: flex; justify-content: space-between;
}
.dropdown-item:hover { background: var(--bg-elevated); color: white; }
.shortcut { color: var(--text-faint); font-size: 0.75rem; }

/* === CONTEXT MENU === */
.context-menu {
    position: fixed;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    border-radius: 8px;
    padding: 4px;
    min-width: 180px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    z-index: 3000;
    display: none;
    max-height: 80vh;
    overflow-y: auto;
}

.context-menu.visible { display: block; }

/* Touch-friendly on mobile */
@media (max-width: 768px) {
    .context-menu { min-width: 200px; }
    .context-item { padding: 12px 16px; font-size: 0.9rem; }
}

.context-item {
    padding: 8px 12px;
    font-size: 0.85rem;
    color: var(--text-muted);
    cursor: pointer;
    border-radius: 4px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.context-item:hover { background: rgba(255,255,255,0.05); color: white; }
.context-item svg { width: 16px; height: 16px; }

.context-divider {
    height: 1px;
    background: var(--border-subtle);
    margin: 4px 0;
}

.context-submenu {
    position: relative;
}

.context-submenu-arrow {
    margin-left: auto;
    font-size: 0.7rem;
}

.submenu-content {
    position: absolute;
    left: 100%;
    top: 0;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    border-radius: 8px;
    padding: 4px;
    min-width: 140px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    display: none;
}

.context-submenu:hover .submenu-content { display: block; }

/* === SIDEBAR CONTEXT MENU === */
.slide-options-btn {
    position: absolute; top: 4px; right: 4px;
    width: 24px; height: 24px; border-radius: 4px;
    background: rgba(0,0,0,0.6); color: white; border: none;
    display: none; align-items: center; justify-content: center;
    cursor: pointer; z-index: 10;
}
.slide-wrapper:hover .slide-options-btn { display: flex; }
.slide-options-btn:hover { background: var(--accent-orange); }

.slide-context-menu {
    position: absolute; top: 30px; right: 4px;
    background: var(--bg-elevated); border: 1px solid var(--border-subtle);
    border-radius: 6px; padding: 4px; width: 120px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    display: none; flex-direction: column; z-index: 100;
}
.slide-context-menu.visible { display: flex; }

.slide-wrapper {
    position: relative;
    transition: transform 0.2s ease;
}

/* The container for the buttons (Hidden by default, shows on hover) */
.slide-controls {
    position: absolute;
    top: 8px; right: 8px;
    display: flex; flex-direction: column; gap: 4px;
    opacity: 0; pointer-events: none; /* unobtrusive */
    transition: opacity 0.2s ease, transform 0.2s ease;
    transform: translateX(10px);
    z-index: 50;
}

/* Show on hover */
.slide-wrapper:hover .slide-controls {
    opacity: 1; pointer-events: auto;
    transform: translateX(0);
}

/* The fluid buttons */
.slide-control-btn {
    width: 28px; height: 28px;
    border-radius: 6px;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
    color: var(--text-muted);
    cursor: pointer;
    display: grid; place-items: center;
    transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
}

.slide-control-btn:hover {
    background: var(--bg-elevated);
    color: white;
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.slide-control-btn.delete:hover {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    border-color: rgba(239, 68, 68, 0.3);
}

/* === FONT SELECTOR PREVIEW === */
.font-select option {
    padding: 8px;
    font-size: 1rem;
    background: var(--bg-surface);
}

/* === SAVE STATUS === */
.save-status {
    font-size: 0.75rem;
    color: var(--text-muted);
    padding: 4px 8px;
    border-radius: 4px;
    transition: 0.2s;
}

.save-status.saving {
    color: var(--accent-orange);
}

/* === LOADING STATE === */
.loading-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 5000;
}

.loading-spinner {
    width: 40px; height: 40px;
    border: 3px solid var(--border-subtle);
    border-top-color: var(--accent-orange);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* === HELP MODAL === */
.help-modal .modal {
    width: 500px;
    text-align: left;
}

.help-shortcuts {
    display: grid;
    gap: 12px;
    margin-top: 1rem;
}

.help-shortcut {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: var(--bg-elevated);
    border-radius: 6px;
}

.help-key {
    background: var(--bg-surface);
    padding: 4px 8px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    border: 1px solid var(--border-subtle);
}

/* === BACKGROUND COLOR PICKER === */
.bg-color-picker {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: var(--bg-elevated);
    border-radius: 8px;
    margin-top: 8px;
}

.bg-color-picker label {
    font-size: 0.85rem;
    color: var(--text-muted);
}

/* === NOTIFICATIONS === */
.notification {
    position: fixed; top: 20px; right: 20px;
    background: var(--bg-elevated); border: 1px solid var(--border-subtle);
    border-radius: 8px; padding: 12px 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    z-index: 6000; min-width: 250px;
    transform: translateX(400px);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.notification.show {
    transform: translateX(0);
}
.notification-content {
    display: flex; align-items: center; gap: 10px;
}
.notification-icon {
    font-size: 1.2rem; font-weight: bold;
}
.notification-message {
    color: var(--text-primary); font-size: 0.9rem;
}
.notification-success {
    border-left: 3px solid #10b981;
}
.notification-success .notification-icon {
    color: #10b981;
}
.notification-error {
    border-left: 3px solid #ef4444;
}
.notification-error .notification-icon {
    color: #ef4444;
}
.notification-info {
    border-left: 3px solid var(--accent-orange);
}
.notification-info .notification-icon {
    color: var(--accent-orange);
}

@media (max-width: 768px) {
    .notification {
        top: 10px; right: 10px; left: 10px;
        min-width: auto;
    }
}
